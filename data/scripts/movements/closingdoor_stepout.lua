-- Converted from: closingdoor.lua
-- Event: StepOut

local moveEvent1 = MoveEvent()
moveEvent1:type("stepout")
moveEvent1:id(1224)

local moveEvent2 = MoveEvent()
moveEvent2:type("stepout")
moveEvent2:id(1226)

local moveEvent3 = MoveEvent()
moveEvent3:type("stepout")
moveEvent3:id(1242)

local moveEvent4 = MoveEvent()
moveEvent4:type("stepout")
moveEvent4:id(1244)

local moveEvent5 = MoveEvent()
moveEvent5:type("stepout")
moveEvent5:id(1256)

local moveEvent6 = MoveEvent()
moveEvent6:type("stepout")
moveEvent6:id(1258)

local moveEvent7 = MoveEvent()
moveEvent7:type("stepout")
moveEvent7:id(3543)

local moveEvent8 = MoveEvent()
moveEvent8:type("stepout")
moveEvent8:id(3552)

local moveEvent9 = MoveEvent()
moveEvent9:type("stepout")
moveEvent9:id(5106)

local moveEvent10 = MoveEvent()
moveEvent10:type("stepout")
moveEvent10:id(5115)

local moveEvent11 = MoveEvent()
moveEvent11:type("stepout")
moveEvent11:id(5124)

local moveEvent12 = MoveEvent()
moveEvent12:type("stepout")
moveEvent12:id(5133)

local moveEvent13 = MoveEvent()
moveEvent13:type("stepout")
moveEvent13:id(5289)

local moveEvent14 = MoveEvent()
moveEvent14:type("stepout")
moveEvent14:id(5291)

local moveEvent15 = MoveEvent()
moveEvent15:type("stepout")
moveEvent15:id(5746)

local moveEvent16 = MoveEvent()
moveEvent16:type("stepout")
moveEvent16:id(5749)

local moveEvent17 = MoveEvent()
moveEvent17:type("stepout")
moveEvent17:id(6203)

local moveEvent18 = MoveEvent()
moveEvent18:type("stepout")
moveEvent18:id(6205)

local moveEvent19 = MoveEvent()
moveEvent19:type("stepout")
moveEvent19:id(6260)

local moveEvent20 = MoveEvent()
moveEvent20:type("stepout")
moveEvent20:id(6262)

local moveEvent21 = MoveEvent()
moveEvent21:type("stepout")
moveEvent21:id(6899)

local moveEvent22 = MoveEvent()
moveEvent22:type("stepout")
moveEvent22:id(6908)

local moveEvent23 = MoveEvent()
moveEvent23:type("stepout")
moveEvent23:id(7041)

local moveEvent24 = MoveEvent()
moveEvent24:type("stepout")
moveEvent24:id(7050)

local moveEvent25 = MoveEvent()
moveEvent25:type("stepout")
moveEvent25:id(8552)

local moveEvent26 = MoveEvent()
moveEvent26:type("stepout")
moveEvent26:id(8554)

local moveEvent27 = MoveEvent()
moveEvent27:type("stepout")
moveEvent27:id(9176)

local moveEvent28 = MoveEvent()
moveEvent28:type("stepout")
moveEvent28:id(9178)

local moveEvent29 = MoveEvent()
moveEvent29:type("stepout")
moveEvent29:id(9278)

local moveEvent30 = MoveEvent()
moveEvent30:type("stepout")
moveEvent30:id(9280)

local moveEvent31 = MoveEvent()
moveEvent31:type("stepout")
moveEvent31:id(10279)

local moveEvent32 = MoveEvent()
moveEvent32:type("stepout")
moveEvent32:id(10281)

local moveEvent33 = MoveEvent()
moveEvent33:type("stepout")
moveEvent33:id(10476)

local moveEvent34 = MoveEvent()
moveEvent34:type("stepout")
moveEvent34:id(10485)

local moveEvent35 = MoveEvent()
moveEvent35:type("stepout")
moveEvent35:id(10783)

local moveEvent36 = MoveEvent()
moveEvent36:type("stepout")
moveEvent36:id(10792)

local moveEvent37 = MoveEvent()
moveEvent37:type("stepout")
moveEvent37:id(12105)

local moveEvent38 = MoveEvent()
moveEvent38:type("stepout")
moveEvent38:id(12194)

local moveEvent39 = MoveEvent()
moveEvent39:type("stepout")
moveEvent39:id(12203)

local moveEvent40 = MoveEvent()
moveEvent40:type("stepout")
moveEvent40:id(19848)

local moveEvent41 = MoveEvent()
moveEvent41:type("stepout")
moveEvent41:id(19857)

local moveEvent42 = MoveEvent()
moveEvent42:type("stepout")
moveEvent42:id(19988)

local moveEvent43 = MoveEvent()
moveEvent43:type("stepout")
moveEvent43:id(19997)

local moveEvent44 = MoveEvent()
moveEvent44:type("stepout")
moveEvent44:id(20281)

local moveEvent45 = MoveEvent()
moveEvent45:type("stepout")
moveEvent45:id(20288)

local moveEvent46 = MoveEvent()
moveEvent46:type("stepout")
moveEvent46:id(1228)

local moveEvent47 = MoveEvent()
moveEvent47:type("stepout")
moveEvent47:id(1230)

local moveEvent48 = MoveEvent()
moveEvent48:type("stepout")
moveEvent48:id(1246)

local moveEvent49 = MoveEvent()
moveEvent49:type("stepout")
moveEvent49:id(1248)

local moveEvent50 = MoveEvent()
moveEvent50:type("stepout")
moveEvent50:id(1260)

local moveEvent51 = MoveEvent()
moveEvent51:type("stepout")
moveEvent51:id(1262)

local moveEvent52 = MoveEvent()
moveEvent52:type("stepout")
moveEvent52:id(3541)

local moveEvent53 = MoveEvent()
moveEvent53:type("stepout")
moveEvent53:id(3550)

local moveEvent54 = MoveEvent()
moveEvent54:type("stepout")
moveEvent54:id(5104)

local moveEvent55 = MoveEvent()
moveEvent55:type("stepout")
moveEvent55:id(5113)

local moveEvent56 = MoveEvent()
moveEvent56:type("stepout")
moveEvent56:id(5122)

local moveEvent57 = MoveEvent()
moveEvent57:type("stepout")
moveEvent57:id(5131)

local moveEvent58 = MoveEvent()
moveEvent58:type("stepout")
moveEvent58:id(5293)

local moveEvent59 = MoveEvent()
moveEvent59:type("stepout")
moveEvent59:id(5295)

local moveEvent60 = MoveEvent()
moveEvent60:type("stepout")
moveEvent60:id(6207)

local moveEvent61 = MoveEvent()
moveEvent61:type("stepout")
moveEvent61:id(6209)

local moveEvent62 = MoveEvent()
moveEvent62:type("stepout")
moveEvent62:id(6264)

local moveEvent63 = MoveEvent()
moveEvent63:type("stepout")
moveEvent63:id(6266)

local moveEvent64 = MoveEvent()
moveEvent64:type("stepout")
moveEvent64:id(6897)

local moveEvent65 = MoveEvent()
moveEvent65:type("stepout")
moveEvent65:id(6906)

local moveEvent66 = MoveEvent()
moveEvent66:type("stepout")
moveEvent66:id(7039)

local moveEvent67 = MoveEvent()
moveEvent67:type("stepout")
moveEvent67:id(7048)

local moveEvent68 = MoveEvent()
moveEvent68:type("stepout")
moveEvent68:id(8556)

local moveEvent69 = MoveEvent()
moveEvent69:type("stepout")
moveEvent69:id(8558)

local moveEvent70 = MoveEvent()
moveEvent70:type("stepout")
moveEvent70:id(9180)

local moveEvent71 = MoveEvent()
moveEvent71:type("stepout")
moveEvent71:id(9182)

local moveEvent72 = MoveEvent()
moveEvent72:type("stepout")
moveEvent72:id(9282)

local moveEvent73 = MoveEvent()
moveEvent73:type("stepout")
moveEvent73:id(9284)

local moveEvent74 = MoveEvent()
moveEvent74:type("stepout")
moveEvent74:id(10283)

local moveEvent75 = MoveEvent()
moveEvent75:type("stepout")
moveEvent75:id(10285)

local moveEvent76 = MoveEvent()
moveEvent76:type("stepout")
moveEvent76:id(10474)

local moveEvent77 = MoveEvent()
moveEvent77:type("stepout")
moveEvent77:id(10483)

local moveEvent78 = MoveEvent()
moveEvent78:type("stepout")
moveEvent78:id(10781)

local moveEvent79 = MoveEvent()
moveEvent79:type("stepout")
moveEvent79:id(10790)

local moveEvent80 = MoveEvent()
moveEvent80:type("stepout")
moveEvent80:id(12098)

local moveEvent81 = MoveEvent()
moveEvent81:type("stepout")
moveEvent81:id(12103)

local moveEvent82 = MoveEvent()
moveEvent82:type("stepout")
moveEvent82:id(12196)

local moveEvent83 = MoveEvent()
moveEvent83:type("stepout")
moveEvent83:id(12205)

local moveEvent84 = MoveEvent()
moveEvent84:type("stepout")
moveEvent84:id(19846)

local moveEvent85 = MoveEvent()
moveEvent85:type("stepout")
moveEvent85:id(19855)

local moveEvent86 = MoveEvent()
moveEvent86:type("stepout")
moveEvent86:id(19986)

local moveEvent87 = MoveEvent()
moveEvent87:type("stepout")
moveEvent87:id(19995)

local moveEvent88 = MoveEvent()
moveEvent88:type("stepout")
moveEvent88:id(20279)

local moveEvent89 = MoveEvent()
moveEvent89:type("stepout")
moveEvent89:id(20290)

local function onStepOut(creature, item, position, fromPosition)

	local tile = Tile(position)
	if tile:getCreatureCount() > 0 then
		return true
	end

	local newPosition = {x = position.x + 1, y = position.y, z = position.z}
	local query = Tile(newPosition):queryAdd(creature)
	if query ~= RETURNVALUE_NOERROR or query == RETURNVALUE_NOTENOUGHROOM then
		newPosition.x = newPosition.x - 1
		newPosition.y = newPosition.y + 1
		query = Tile(newPosition):queryAdd(creature)
	end

	if query == RETURNVALUE_NOERROR or query ~= RETURNVALUE_NOTENOUGHROOM then
		doRelocate(position, newPosition)
	end

	local i, tileItem, tileCount = 1, true, tile:getThingCount()
	while tileItem and i < tileCount do
		tileItem = tile:getThing(i)
		if tileItem and tileItem:getUniqueId() ~= item.uid and tileItem:getType():isMovable() then
			tileItem:remove()
		else
			i = i + 1
		end
	end

	item:transform(item.itemid - 1)
	return true
end

moveEvent1:onStepOut(onStepOut)
moveEvent1:register()
moveEvent2:onStepOut(onStepOut)
moveEvent2:register()
moveEvent3:onStepOut(onStepOut)
moveEvent3:register()
moveEvent4:onStepOut(onStepOut)
moveEvent4:register()
moveEvent5:onStepOut(onStepOut)
moveEvent5:register()
moveEvent6:onStepOut(onStepOut)
moveEvent6:register()
moveEvent7:onStepOut(onStepOut)
moveEvent7:register()
moveEvent8:onStepOut(onStepOut)
moveEvent8:register()
moveEvent9:onStepOut(onStepOut)
moveEvent9:register()
moveEvent10:onStepOut(onStepOut)
moveEvent10:register()
moveEvent11:onStepOut(onStepOut)
moveEvent11:register()
moveEvent12:onStepOut(onStepOut)
moveEvent12:register()
moveEvent13:onStepOut(onStepOut)
moveEvent13:register()
moveEvent14:onStepOut(onStepOut)
moveEvent14:register()
moveEvent15:onStepOut(onStepOut)
moveEvent15:register()
moveEvent16:onStepOut(onStepOut)
moveEvent16:register()
moveEvent17:onStepOut(onStepOut)
moveEvent17:register()
moveEvent18:onStepOut(onStepOut)
moveEvent18:register()
moveEvent19:onStepOut(onStepOut)
moveEvent19:register()
moveEvent20:onStepOut(onStepOut)
moveEvent20:register()
moveEvent21:onStepOut(onStepOut)
moveEvent21:register()
moveEvent22:onStepOut(onStepOut)
moveEvent22:register()
moveEvent23:onStepOut(onStepOut)
moveEvent23:register()
moveEvent24:onStepOut(onStepOut)
moveEvent24:register()
moveEvent25:onStepOut(onStepOut)
moveEvent25:register()
moveEvent26:onStepOut(onStepOut)
moveEvent26:register()
moveEvent27:onStepOut(onStepOut)
moveEvent27:register()
moveEvent28:onStepOut(onStepOut)
moveEvent28:register()
moveEvent29:onStepOut(onStepOut)
moveEvent29:register()
moveEvent30:onStepOut(onStepOut)
moveEvent30:register()
moveEvent31:onStepOut(onStepOut)
moveEvent31:register()
moveEvent32:onStepOut(onStepOut)
moveEvent32:register()
moveEvent33:onStepOut(onStepOut)
moveEvent33:register()
moveEvent34:onStepOut(onStepOut)
moveEvent34:register()
moveEvent35:onStepOut(onStepOut)
moveEvent35:register()
moveEvent36:onStepOut(onStepOut)
moveEvent36:register()
moveEvent37:onStepOut(onStepOut)
moveEvent37:register()
moveEvent38:onStepOut(onStepOut)
moveEvent38:register()
moveEvent39:onStepOut(onStepOut)
moveEvent39:register()
moveEvent40:onStepOut(onStepOut)
moveEvent40:register()
moveEvent41:onStepOut(onStepOut)
moveEvent41:register()
moveEvent42:onStepOut(onStepOut)
moveEvent42:register()
moveEvent43:onStepOut(onStepOut)
moveEvent43:register()
moveEvent44:onStepOut(onStepOut)
moveEvent44:register()
moveEvent45:onStepOut(onStepOut)
moveEvent45:register()
moveEvent46:onStepOut(onStepOut)
moveEvent46:register()
moveEvent47:onStepOut(onStepOut)
moveEvent47:register()
moveEvent48:onStepOut(onStepOut)
moveEvent48:register()
moveEvent49:onStepOut(onStepOut)
moveEvent49:register()
moveEvent50:onStepOut(onStepOut)
moveEvent50:register()
moveEvent51:onStepOut(onStepOut)
moveEvent51:register()
moveEvent52:onStepOut(onStepOut)
moveEvent52:register()
moveEvent53:onStepOut(onStepOut)
moveEvent53:register()
moveEvent54:onStepOut(onStepOut)
moveEvent54:register()
moveEvent55:onStepOut(onStepOut)
moveEvent55:register()
moveEvent56:onStepOut(onStepOut)
moveEvent56:register()
moveEvent57:onStepOut(onStepOut)
moveEvent57:register()
moveEvent58:onStepOut(onStepOut)
moveEvent58:register()
moveEvent59:onStepOut(onStepOut)
moveEvent59:register()
moveEvent60:onStepOut(onStepOut)
moveEvent60:register()
moveEvent61:onStepOut(onStepOut)
moveEvent61:register()
moveEvent62:onStepOut(onStepOut)
moveEvent62:register()
moveEvent63:onStepOut(onStepOut)
moveEvent63:register()
moveEvent64:onStepOut(onStepOut)
moveEvent64:register()
moveEvent65:onStepOut(onStepOut)
moveEvent65:register()
moveEvent66:onStepOut(onStepOut)
moveEvent66:register()
moveEvent67:onStepOut(onStepOut)
moveEvent67:register()
moveEvent68:onStepOut(onStepOut)
moveEvent68:register()
moveEvent69:onStepOut(onStepOut)
moveEvent69:register()
moveEvent70:onStepOut(onStepOut)
moveEvent70:register()
moveEvent71:onStepOut(onStepOut)
moveEvent71:register()
moveEvent72:onStepOut(onStepOut)
moveEvent72:register()
moveEvent73:onStepOut(onStepOut)
moveEvent73:register()
moveEvent74:onStepOut(onStepOut)
moveEvent74:register()
moveEvent75:onStepOut(onStepOut)
moveEvent75:register()
moveEvent76:onStepOut(onStepOut)
moveEvent76:register()
moveEvent77:onStepOut(onStepOut)
moveEvent77:register()
moveEvent78:onStepOut(onStepOut)
moveEvent78:register()
moveEvent79:onStepOut(onStepOut)
moveEvent79:register()
moveEvent80:onStepOut(onStepOut)
moveEvent80:register()
moveEvent81:onStepOut(onStepOut)
moveEvent81:register()
moveEvent82:onStepOut(onStepOut)
moveEvent82:register()
moveEvent83:onStepOut(onStepOut)
moveEvent83:register()
moveEvent84:onStepOut(onStepOut)
moveEvent84:register()
moveEvent85:onStepOut(onStepOut)
moveEvent85:register()
moveEvent86:onStepOut(onStepOut)
moveEvent86:register()
moveEvent87:onStepOut(onStepOut)
moveEvent87:register()
moveEvent88:onStepOut(onStepOut)
moveEvent88:register()
moveEvent89:onStepOut(onStepOut)
moveEvent89:register()