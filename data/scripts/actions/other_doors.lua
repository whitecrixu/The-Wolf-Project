-- Converted from: other/doors.lua
-- Original XML: actions.xml

local action1 = Action()
action1:id(1209)
action1:id(1210)
action1:id(1211)
action1:id(1212)
action1:id(1213)
action1:id(1214)

local action2 = Action()
action2:id(1219)
action2:id(1220)
action2:id(1221)
action2:id(1222)
action2:id(1223)
action2:id(1224)
action2:id(1225)
action2:id(1226)
action2:id(1227)
action2:id(1228)
action2:id(1229)
action2:id(1230)
action2:id(1231)
action2:id(1232)
action2:id(1233)
action2:id(1234)
action2:id(1235)
action2:id(1236)
action2:id(1237)
action2:id(1238)
action2:id(1239)
action2:id(1240)
action2:id(1241)
action2:id(1242)
action2:id(1243)
action2:id(1244)
action2:id(1245)
action2:id(1246)
action2:id(1247)
action2:id(1248)
action2:id(1249)
action2:id(1250)
action2:id(1251)
action2:id(1252)
action2:id(1253)
action2:id(1254)
action2:id(1255)
action2:id(1256)
action2:id(1257)
action2:id(1258)
action2:id(1259)
action2:id(1260)
action2:id(1261)
action2:id(1262)

local action3 = Action()
action3:id(1539)
action3:id(1540)
action3:id(1541)
action3:id(1542)

local action4 = Action()
action4:id(2086)
action4:id(2087)
action4:id(2088)
action4:id(2089)
action4:id(2090)
action4:id(2091)
action4:id(2092)

local action5 = Action()
action5:id(3535)
action5:id(3536)
action5:id(3537)
action5:id(3538)
action5:id(3539)
action5:id(3540)
action5:id(3541)
action5:id(3542)
action5:id(3543)
action5:id(3544)
action5:id(3545)
action5:id(3546)
action5:id(3547)
action5:id(3548)
action5:id(3549)
action5:id(3550)
action5:id(3551)
action5:id(3552)

local action6 = Action()
action6:id(4913)
action6:id(4914)
action6:id(4915)
action6:id(4916)
action6:id(4917)
action6:id(4918)

local action7 = Action()
action7:id(5082)
action7:id(5083)
action7:id(5084)
action7:id(5085)

local action8 = Action()
action8:id(5098)
action8:id(5099)
action8:id(5100)
action8:id(5101)
action8:id(5102)
action8:id(5103)
action8:id(5104)
action8:id(5105)
action8:id(5106)
action8:id(5107)
action8:id(5108)
action8:id(5109)
action8:id(5110)
action8:id(5111)
action8:id(5112)
action8:id(5113)
action8:id(5114)
action8:id(5115)
action8:id(5116)
action8:id(5117)
action8:id(5118)
action8:id(5119)
action8:id(5120)
action8:id(5121)
action8:id(5122)
action8:id(5123)
action8:id(5124)
action8:id(5125)
action8:id(5126)
action8:id(5127)
action8:id(5128)
action8:id(5129)
action8:id(5130)
action8:id(5131)
action8:id(5132)
action8:id(5133)
action8:id(5134)
action8:id(5135)
action8:id(5136)
action8:id(5137)
action8:id(5138)
action8:id(5139)
action8:id(5140)
action8:id(5141)
action8:id(5142)
action8:id(5143)
action8:id(5144)
action8:id(5145)

local action9 = Action()
action9:id(5278)
action9:id(5279)
action9:id(5280)
action9:id(5281)
action9:id(5282)
action9:id(5283)
action9:id(5284)
action9:id(5285)
action9:id(5286)
action9:id(5287)
action9:id(5288)
action9:id(5289)
action9:id(5290)
action9:id(5291)
action9:id(5292)
action9:id(5293)
action9:id(5294)
action9:id(5295)

local action10 = Action()
action10:id(5515)
action10:id(5516)
action10:id(5517)
action10:id(5518)

local action11 = Action()
action11:id(5732)
action11:id(5733)
action11:id(5734)
action11:id(5735)
action11:id(5736)
action11:id(5737)

local action12 = Action()
action12:id(5745)
action12:id(5746)
action12:id(5747)
action12:id(5748)
action12:id(5749)

local action13 = Action()
action13:id(6192)
action13:id(6193)
action13:id(6194)
action13:id(6195)
action13:id(6196)
action13:id(6197)
action13:id(6198)
action13:id(6199)
action13:id(6200)
action13:id(6201)
action13:id(6202)
action13:id(6203)
action13:id(6204)
action13:id(6205)
action13:id(6206)
action13:id(6207)
action13:id(6208)
action13:id(6209)

local action14 = Action()
action14:id(6249)
action14:id(6250)
action14:id(6251)
action14:id(6252)
action14:id(6253)
action14:id(6254)
action14:id(6255)
action14:id(6256)
action14:id(6257)
action14:id(6258)
action14:id(6259)
action14:id(6260)
action14:id(6261)
action14:id(6262)
action14:id(6263)
action14:id(6264)
action14:id(6265)
action14:id(6266)

local action15 = Action()
action15:id(6795)
action15:id(6796)
action15:id(6797)
action15:id(6798)
action15:id(6799)
action15:id(6800)
action15:id(6801)
action15:id(6802)

local action16 = Action()
action16:id(6891)
action16:id(6892)
action16:id(6893)
action16:id(6894)
action16:id(6895)
action16:id(6896)
action16:id(6897)
action16:id(6898)
action16:id(6899)
action16:id(6900)
action16:id(6901)
action16:id(6902)
action16:id(6903)
action16:id(6904)
action16:id(6905)
action16:id(6906)
action16:id(6907)
action16:id(6908)

local action17 = Action()
action17:id(7033)
action17:id(7034)
action17:id(7035)
action17:id(7036)
action17:id(7037)
action17:id(7038)
action17:id(7039)
action17:id(7040)
action17:id(7041)
action17:id(7042)
action17:id(7043)
action17:id(7044)
action17:id(7045)
action17:id(7046)
action17:id(7047)
action17:id(7048)
action17:id(7049)
action17:id(7050)

local action18 = Action()
action18:id(7054)
action18:id(7055)
action18:id(7056)
action18:id(7057)

local action19 = Action()
action19:id(8541)
action19:id(8542)
action19:id(8543)
action19:id(8544)
action19:id(8545)
action19:id(8546)
action19:id(8547)
action19:id(8548)
action19:id(8549)
action19:id(8550)
action19:id(8551)
action19:id(8552)
action19:id(8553)
action19:id(8554)
action19:id(8555)
action19:id(8556)
action19:id(8557)
action19:id(8558)

local action20 = Action()
action20:id(9165)
action20:id(9166)
action20:id(9167)
action20:id(9168)
action20:id(9169)
action20:id(9170)
action20:id(9171)
action20:id(9172)
action20:id(9173)
action20:id(9174)
action20:id(9175)
action20:id(9176)
action20:id(9177)
action20:id(9178)
action20:id(9179)
action20:id(9180)
action20:id(9181)
action20:id(9182)
action20:id(9183)
action20:id(9184)

local action21 = Action()
action21:id(9267)
action21:id(9268)
action21:id(9269)
action21:id(9270)
action21:id(9271)
action21:id(9272)
action21:id(9273)
action21:id(9274)
action21:id(9275)
action21:id(9276)
action21:id(9277)
action21:id(9278)
action21:id(9279)
action21:id(9280)
action21:id(9281)
action21:id(9282)
action21:id(9283)
action21:id(9284)

local action22 = Action()
action22:id(10032)

local action23 = Action()
action23:id(10268)
action23:id(10269)
action23:id(10270)
action23:id(10271)
action23:id(10272)
action23:id(10273)
action23:id(10274)
action23:id(10275)
action23:id(10276)
action23:id(10277)
action23:id(10278)
action23:id(10279)
action23:id(10280)
action23:id(10281)
action23:id(10282)
action23:id(10283)
action23:id(10284)
action23:id(10285)

local action24 = Action()
action24:id(10468)
action24:id(10469)
action24:id(10470)
action24:id(10471)
action24:id(10472)
action24:id(10473)
action24:id(10474)
action24:id(10475)
action24:id(10476)
action24:id(10477)
action24:id(10478)
action24:id(10479)
action24:id(10480)
action24:id(10481)
action24:id(10482)
action24:id(10483)
action24:id(10484)
action24:id(10485)
action24:id(10486)

local action25 = Action()
action25:id(10775)
action25:id(10776)
action25:id(10777)

local action26 = Action()
action26:id(10780)
action26:id(10781)
action26:id(10782)
action26:id(10783)
action26:id(10784)
action26:id(10785)
action26:id(10786)

local action27 = Action()
action27:id(10789)
action27:id(10790)
action27:id(10791)
action27:id(10792)

local action28 = Action()
action28:id(12092)
action28:id(12093)
action28:id(12094)
action28:id(12095)
action28:id(12096)
action28:id(12097)
action28:id(12098)
action28:id(12099)
action28:id(12100)
action28:id(12101)
action28:id(12102)
action28:id(12103)
action28:id(12104)
action28:id(12105)

local action29 = Action()
action29:id(12188)
action29:id(12189)
action29:id(12190)

local action30 = Action()
action30:id(12193)
action30:id(12194)
action30:id(12195)
action30:id(12196)
action30:id(12197)
action30:id(12198)
action30:id(12199)

local action31 = Action()
action31:id(12202)
action31:id(12203)
action31:id(12204)
action31:id(12205)

local action32 = Action()
action32:id(19840)
action32:id(19841)
action32:id(19842)
action32:id(19843)
action32:id(19844)
action32:id(19845)
action32:id(19846)
action32:id(19847)
action32:id(19848)
action32:id(19849)
action32:id(19850)
action32:id(19851)
action32:id(19852)
action32:id(19853)
action32:id(19854)
action32:id(19855)
action32:id(19856)
action32:id(19857)

local action33 = Action()
action33:id(19980)
action33:id(19981)
action33:id(19982)
action33:id(19983)
action33:id(19984)
action33:id(19985)
action33:id(19986)
action33:id(19987)
action33:id(19988)
action33:id(19989)
action33:id(19990)
action33:id(19991)
action33:id(19992)
action33:id(19993)
action33:id(19994)
action33:id(19995)
action33:id(19996)
action33:id(19997)

local action34 = Action()
action34:id(20273)
action34:id(20274)
action34:id(20275)
action34:id(20276)
action34:id(20277)
action34:id(20278)
action34:id(20279)
action34:id(20280)
action34:id(20281)
action34:id(20282)
action34:id(20283)
action34:id(20284)
action34:id(20285)
action34:id(20286)
action34:id(20287)
action34:id(20288)
action34:id(20289)
action34:id(20290)

local action35 = Action()
action35:id(17235)
action35:id(17236)
action35:id(17237)
action35:id(17238)

local action36 = Action()
action36:id(18208)
action36:id(18209)

local action37 = Action()
action37:id(13020)
action37:id(13021)
action37:id(13022)
action37:id(13023)

local function onUse(player, item, fromPosition, target, toPosition, isHotkey)

	local itemId = item:getId()
	if isInArray(questDoors, itemId) then
		if player:getStorageValue(item.actionid) ~= -1 then
			item:transform(itemId + 1)
			player:teleportTo(toPosition, true)
		else
			player:sendTextMessage(MESSAGE_INFO_DESCR, "The door seems to be sealed against unwanted intruders.")
		end
		return true
	elseif isInArray(levelDoors, itemId) then
		if item.actionid > 0 and player:getLevel() >= item.actionid - 1000 then
			item:transform(itemId + 1)
			player:teleportTo(toPosition, true)
		else
			player:sendTextMessage(MESSAGE_INFO_DESCR, "Only the worthy may pass.")
		end
		return true
	elseif isInArray(blockDoors, itemId) then
		player:sendTextMessage(MESSAGE_STATUS_SMALL, "It is locked.")
		return true
	elseif isInArray(keys, itemId) then
		if target.actionid > 0 then
			if item.actionid == target.actionid and doors[target.itemid] then
				target:transform(doors[target.itemid])
				return true
			end
			player:sendTextMessage(MESSAGE_STATUS_SMALL, "The key does not match.")
			return true
		end
		return false
	end

	if isInArray(horizontalOpenDoors, itemId) or isInArray(verticalOpenDoors, itemId) then
		local doorCreature = Tile(toPosition):getTopCreature()
		if doorCreature ~= nil then
			toPosition.x = toPosition.x + 1
			local query = Tile(toPosition):queryAdd(doorCreature, bit.bor(FLAG_IGNOREBLOCKCREATURE, FLAG_PATHFINDING))
			if query ~= RETURNVALUE_NOERROR then
				toPosition.x = toPosition.x - 1
				toPosition.y = toPosition.y + 1
				query = Tile(toPosition):queryAdd(doorCreature, bit.bor(FLAG_IGNOREBLOCKCREATURE, FLAG_PATHFINDING))
			end

			if query ~= RETURNVALUE_NOERROR then
				player:sendTextMessage(MESSAGE_STATUS_SMALL, query)
				return true
			end

			doorCreature:teleportTo(toPosition, true)
		end

		if not isInArray(openSpecialDoors, itemId) then
			item:transform(itemId - 1)
		end
		return true
	end

	if doors[itemId] then
		if item.actionid == 0 then
			item:transform(doors[itemId])
		else
			player:sendTextMessage(MESSAGE_INFO_DESCR, "It is locked.")
		end
		return true
	end
	return false
end

action1:onUse(onUse)
action1:register()
action2:onUse(onUse)
action2:register()
action3:onUse(onUse)
action3:register()
action4:onUse(onUse)
action4:register()
action5:onUse(onUse)
action5:register()
action6:onUse(onUse)
action6:register()
action7:onUse(onUse)
action7:register()
action8:onUse(onUse)
action8:register()
action9:onUse(onUse)
action9:register()
action10:onUse(onUse)
action10:register()
action11:onUse(onUse)
action11:register()
action12:onUse(onUse)
action12:register()
action13:onUse(onUse)
action13:register()
action14:onUse(onUse)
action14:register()
action15:onUse(onUse)
action15:register()
action16:onUse(onUse)
action16:register()
action17:onUse(onUse)
action17:register()
action18:onUse(onUse)
action18:register()
action19:onUse(onUse)
action19:register()
action20:onUse(onUse)
action20:register()
action21:onUse(onUse)
action21:register()
action22:onUse(onUse)
action22:register()
action23:onUse(onUse)
action23:register()
action24:onUse(onUse)
action24:register()
action25:onUse(onUse)
action25:register()
action26:onUse(onUse)
action26:register()
action27:onUse(onUse)
action27:register()
action28:onUse(onUse)
action28:register()
action29:onUse(onUse)
action29:register()
action30:onUse(onUse)
action30:register()
action31:onUse(onUse)
action31:register()
action32:onUse(onUse)
action32:register()
action33:onUse(onUse)
action33:register()
action34:onUse(onUse)
action34:register()
action35:onUse(onUse)
action35:register()
action36:onUse(onUse)
action36:register()
action37:onUse(onUse)
action37:register()